======================================================   EIBMRP1A    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA LIST.REPTDATE;
    SET LN.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA LIST.DISRPT;
   INFILE ELDS FIRSTOBS=2;
   INPUT @001 PTYPE       $8.
         @012 MAANO       $15.
         @030 AANO        $15.
         @048 BRANCH      3.
         @052 BRCHABR     $3.
         @058 REGION      $4.
         @065 CUSTNAME    $150.
         @218 ACCTNO1     12.
         @233 NOTENO      5.
         @241 FACNAME     $60.
         @304 FACGRP      10.
         @317 APPRAMT     COMMA15.
         @335 OUTSTAND    COMMA15.
         @353 DSR         5.
         @361 CRR         $5.
         @369 MA          $6.
         @378 APPRNAME    $60.
         @441 APPRDATE1   $10.
         @454 ACCPTDATE1  $10.
         @467 NRRTAG      $4.
         @474 EXTFAC      $200.
         @677 REQNO       $200.
         @880 CUSTID      $200.
        @1083 MRISKGRD    $8.
        @1094 SCORECARD   $2.
        @1099 CCRISCOMM   $1.
        @1103 COMSCORE    $13.
        @1119 COMSCORETYP $16.
         ;
    TKDATE = &REPTDATE;
    APPRDATE = MDY(SUBSTR(APPRDATE1,4,2),SUBSTR(APPRDATE1,1,2),
                   SUBSTR(APPRDATE1,7,4));
    ACCPTDATE = MDY(SUBSTR(ACCPTDATE1,4,2),SUBSTR(ACCPTDATE1,1,2),
                    SUBSTR(ACCPTDATE1,7,4));
    *IF MONTH(ACCPTDATE)= MONTH(&REPTDATE);
    IF PTYPE = 'PBB';
RUN;
 /*
DATA LIST.BT(KEEP=ACCTNO1 TFDESC01 APPRLIMT TYPE
        RENAME=(TFDESC01=AANO));
   FORMAT TYPE $2.;
   SET BT.BTDTL&REPTYEAR&REPTMON&REPTDAY;
   ACCTNO1 = ACCTNO * 1;
   TYPE = 'BT';
RUN; */

DATA LIST.LN(KEEP=ACCTNO NOTENO BALANCE RENAME=(ACCTNO=ACCTNO1));
   SET LN.LNNOTE;
RUN;
   /*
DATA OD(KEEP=ACCTNO APPRLIMT RENAME=(APPRLIMT=BALANCE
        ACCTNO=ACCTNO1));
   SET DP.CURRENT;
RUN;

DATA LIST.LNOD;
   FORMAT TYPE $2.;
   SET LN OD;
RUN;

PROC SORT DATA=LIST.BT NODUPKEY;BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.DISRPT OUT=DISRPT;BY ACCTNO1 AANO;RUN;

DATA LIST.TFINAL;
   MERGE DISRPT(IN=A) LIST.BT(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN; */

PROC SORT DATA=LIST.LN NODUPKEY;BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.DISRPT OUT=DISRPT;BY ACCTNO1 AANO;RUN;

DATA LIST.TFINAL;
   MERGE DISRPT(IN=A) LIST.LN(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   /*
   IF TYPE='BT' THEN DO;
      AMOUNT = APPRLIMT;
   END;
   ELSE DO;
      TYPE='LN';
      AMOUNT = BALANCE;
   END; */
   IF FACGRP = '4' OR NRRTAG = 'NRRS' THEN DO;
      AMOUNT = APPRAMT;
   END;
   ELSE IF NRRTAG = 'NRRR' AND (NOT (2500000000<=ACCTNO<=2599999999)
      OR NOT (2850000000<=ACCTNO<=2859999999) OR
      NOT (3000000000<=ACCTNO<=3999999999)) THEN DO;
      AMOUNT = OUTSTAND;
   END;
   ELSE IF BALANCE NOT IN (0,.) THEN DO;
      AMOUNT = BALANCE;
   END;
   ELSE DO;
     AMOUNT = APPRAMT;
   END;
RUN;

DATA PROVSUB(KEEP=ACCTNUM NOTENO IMPAIRED_LOAN ILAMT MONTHS
             RENAME=(ACCTNUM=ACCTNO1 IMPAIRED_LOAN=IMPAIRED
             MONTHS=MTHARR));
   SET CCRIS.PROVSUBAC&REPTMON&REPTYEAR;
   ILAMT = SUM(BALANCE,INTEREST,OTHERCHG);
   IF IMPAIRED_LOAN = 'Y';
RUN;
PROC SORT DATA=PROVSUB NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA CREDSUB(KEEP=ACCTNUM NOTENO MTHARR RENAME=(ACCTNUM=ACCTNO1));
   SET CCRIS.CREDMSUBAC&REPTMON&REPTYEAR;
   IF ACCTNUM NE .;
RUN;
PROC SORT DATA=CREDSUB NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA LIST.TFINAL;
   MERGE LIST.TFINAL(IN=A) CREDSUB(IN=B);BY ACCTNO1 NOTENO;
   IF A;
RUN;

DATA LIST.TFINAL;
   MERGE LIST.TFINAL(IN=A) PROVSUB(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF IMPAIRED = 'Y' THEN DO;
      AMOUNT = ILAMT;
   END;
RUN;

%MACRO APPEND;
%IF &REPTDAY EQ 31 AND &REPTMON EQ 01 %THEN %DO;
   DATA LIST.TFINAL&REPTYEAR;
      SET LIST.TFINAL;
   RUN;
%END;
%ELSE %IF %SYSFUNC(EXIST(LIST.TFINAL&REPTYEAR)) %THEN %DO;
   DATA LIST.TFINAL&REPTYEAR;
      SET LIST.TFINAL&REPTYEAR;
      IF TKDATE = &REPTDATE THEN DELETE;
   RUN;

   DATA LIST.TFINAL&REPTYEAR;
      SET LIST.TFINAL&REPTYEAR LIST.TFINAL;
   RUN;
%END;
%ELSE %DO;
   DATA LIST.TFINAL&REPTYEAR;
      SET LIST.TFINAL;
   RUN;
%END;
%MEND;
%APPEND;

DATA A1 A2 A3 IM1 IM2;
   SET LIST.TFINAL&REPTYEAR;
   FORMAT CAT $20.;
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
  /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN; */

PROC SORT DATA=A3 OUT=ALN31 ;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31 ;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN; */

DATA GROUP(DROP=IMPAIRED);
   SET A1 A2 A3;
RUN;

DATA GROUP1;
   SET IM1 IM2;
RUN;


DATA BRANCH(KEEP=BRANCH BRABBV)  BRANCH1(KEEP=BRANCH BRABBV) LIST.BR1;
   INFILE DBRANCH FIRSTOBS=2;
   INPUT @01 BRANCH  3.
         @08 BRABBV  $3.
         @15 REGIONR $4.
         @22 REG     $3.
         @29 REGNAME $30.;
   REG1 = LEFT(REG||"/"||REGIONR||"/"||REGNAME);
   REG2 = LEFT(REGIONR||"/"||REGNAME);
   IF REG = . THEN DELETE;
RUN;

DATA BRANCH;
   SET BRANCH;
   FORMAT CAT $20. NRRTAG $4.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      NRRTAG = 'NRRR';CAT = 'CURRENT MONTH';
      OUTPUT;
      NRRTAG = 'NRRS';CAT = 'CURRENT MONTH';
      OUTPUT;
      NRRTAG = 'NRRR';CAT = 'PREVIOUS MONTH';
      OUTPUT;
      NRRTAG = 'NRRS';CAT = 'PREVIOUS MONTH';
      OUTPUT;
      NRRTAG = 'NRRR';CAT = 'YEAR TO DATE';
      OUTPUT;
      NRRTAG = 'NRRS';CAT = 'YEAR TO DATE';
      OUTPUT;
   END;
RUN;

DATA BRANCH1;
   SET BRANCH1;
   FORMAT CAT $20. NRRTAG $4.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      NRRTAG = 'NRRR';CAT = 'CURRENT MONTH'; OUTPUT;
      NRRTAG = 'NRRS';CAT = 'CURRENT MONTH'; OUTPUT;
      NRRTAG = 'NRRR';CAT = 'PREVIOUS MONTH'; OUTPUT;
      NRRTAG = 'NRRS';CAT = 'PREVIOUS MONTH'; OUTPUT;
   END;
RUN;

PROC SORT DATA=GROUP;BY BRANCH NRRTAG CAT ;RUN;

PROC SORT DATA=BRANCH;BY BRANCH NRRTAG CAT ;RUN;


DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH NRRTAG CAT ;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SORT DATA=GROUP1;BY BRANCH NRRTAG CAT ;RUN;
PROC SORT DATA=BRANCH1;BY BRANCH NRRTAG CAT ;RUN;

DATA GROUP1(KEEP=BRANCH BRABBV NRRTAG AMOUNT CAT COUNT);
   MERGE BRANCH1(IN=A) GROUP1(IN=B);BY BRANCH NRRTAG CAT ;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1 ;
RUN;

DATA LIST.FINAL1;
   SET GROUP(IN=A) GROUP1(IN=B);
   IF A THEN IND = 'N';
   IF B THEN IND = 'Y';
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
RUN;

PROC FORMAT;
   VALUE $NRRTAG
      'NRRR' = 'RESCHEDULED'
      'NRRS' = 'REPACKAGING'
      ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

PROC SORT DATA=LIST.FINAL1 OUT=GROUP;BY BRANCH;RUN;

TITLE1 'REPORT 1';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'RESCHEDULED/REPACKAGING)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=GROUP ;
CLASS BRANCH NRRTAG IND CAT;
VAR AMOUNT COUNT ;
FORMAT NRRTAG $NRRTAG. IND $IMPIND. BRANCH BRABBV.;
TABLE (NRRTAG='R&R TYPE' * (BRANCH='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=30;
RUN;


======================================================   EIBMRP1B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE $NRRTAG
      'NRRR' = 'RESCHEDULED'
      'NRRS' = 'REPACKAGING'
      ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

RUN;

PROC SORT DATA=LIST.FINAL1 OUT=GROUP;BY BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 1';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'RESCHEDULED/REPACKAGING)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS BRABBV NRRTAG IND CAT;
VAR AMOUNT COUNT ;
FORMAT NRRTAG $NRRTAG. IND $IMPIND.;
TABLE (NRRTAG='R&R TYPE' * (BRABBV='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2))  / RTS=30;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP1C    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE $NRRTAG
      'NRRR' = 'RESCHEDULED'
      'NRRS' = 'REPACKAGING'
      ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA GROUP;
   SET LIST.FINAL1;
   REG = PUT(BRANCH,REGCODE.);
RUN;
PROC SORT DATA=GROUP;BY BRANCH;RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $31. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;


PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 1';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'RESCHEDULED/REPACKAGING)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB';
WHERE REG = "&&SOURCE&I";
FORMAT BRANCH BRABBV.;
CLASS BRANCH NRRTAG IND CAT;
VAR AMOUNT COUNT ;
FORMAT NRRTAG $NRRTAG. IND $IMPIND.;
TABLE (NRRTAG='R&R TYPE' * (BRANCH='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2))  / RTS=30;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP1D    ======================================================  

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE $NRRTAG
      'NRRR' = 'RESCHEDULED'
      'NRRS' = 'REPACKAGING'
      ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

RUN;

PROC SORT DATA=LIST.FINAL1 OUT=GROUP;BY BRANCH;RUN;
PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 1';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'RESCHEDULED/REPACKAGING)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS BRABBV NRRTAG IND CAT;
VAR AMOUNT COUNT ;
FORMAT NRRTAG $NRRTAG. IND $IMPIND.;
TABLE (NRRTAG='R&R TYPE' * (BRABBV='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2))  / RTS=30;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP2A    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET TEMP.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE FACGRP
       1 = '3OD'
       2 = '2FL'
       3 = '1HL'
       4 = '5RC'
       5 = '4BT'
   OTHER = '6OT'
       ;

   VALUE $FACDEC
      '3OD' = 'OD'
      '2FL' = 'FL'
      '1HL' = 'HL'
      '5RC' = 'RC'
      '4BT' = 'TRADE BILLS'
      '6OT' = 'OTHERS'
       ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
RUN;

DATA A1 A2 A3 IM1 IM2;
   SET TEMP.TFINAL&REPTYEAR;
   FORMAT CAT $20. FACTYPE $3.;
   FACTYPE = PUT(FACGRP,FACGRP.);
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
  /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN; */

PROC SORT DATA=A3 OUT=ALN31 ;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=TEMP.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31 ;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=TEMP.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN; */

DATA GROUP(DROP=IMPAIRED);
   SET A1 A2 A3;
RUN;

DATA GROUP1;
   SET IM1 IM2;
RUN;


DATA BRANCH(KEEP=BRANCH BRABBV)  BRANCH1(KEEP=BRANCH BRABBV) BR1;
  SET TEMP.BR1;
RUN;

DATA BRANCH;
   SET BRANCH;
   FORMAT CAT $20. FACTYPE $3.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      FACTYPE = '1HL';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '2FL';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '3OD';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '4BT';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '5RC';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '6OT';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '1HL';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '2FL';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '3OD';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '4BT';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '5RC';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '6OT';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '1HL';CAT = 'YEAR TO DATE';OUTPUT;
      FACTYPE = '2FL';CAT = 'YEAR TO DATE';OUTPUT;
      FACTYPE = '3OD';CAT = 'YEAR TO DATE';OUTPUT;
      FACTYPE = '4BT';CAT = 'YEAR TO DATE';OUTPUT;
      FACTYPE = '5RC';CAT = 'YEAR TO DATE';OUTPUT;
      FACTYPE = '6OT';CAT = 'YEAR TO DATE';OUTPUT;
   END;
RUN;

DATA BRANCH1;
   SET BRANCH1;
   FORMAT CAT $20. FACTYPE $3.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      FACTYPE = '1HL';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '2FL';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '3OD';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '4BT';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '5RC';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '6OT';CAT = 'CURRENT MONTH';OUTPUT;
      FACTYPE = '1HL';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '2FL';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '3OD';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '4BT';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '5RC';CAT = 'PREVIOUS MONTH';OUTPUT;
      FACTYPE = '6OT';CAT = 'PREVIOUS MONTH';OUTPUT;
   END;
RUN;

PROC SORT DATA=GROUP;BY BRANCH FACTYPE CAT ;RUN;
PROC SORT DATA=BRANCH;BY BRANCH FACTYPE CAT ;RUN;

DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH FACTYPE CAT ;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SORT DATA=GROUP1;BY BRANCH FACTYPE CAT ;RUN;
PROC SORT DATA=BRANCH1;BY BRANCH FACTYPE CAT ;RUN;

DATA GROUP1(KEEP=BRANCH BRABBV FACTYPE CAT AMOUNT COUNT);
   MERGE BRANCH1(IN=A) GROUP1(IN=B);BY BRANCH FACTYPE CAT ;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1 ;
RUN;

DATA TEMP.FINAL2;
   SET GROUP(IN=A) GROUP1(IN=B);
   IF A THEN IND = 'N';
   IF B THEN IND = 'Y';
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

PROC SORT DATA=TEMP.FINAL2 OUT=GROUP;BY BRANCH;RUN;

TITLE1 'REPORT 2';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'LOAN/FINANCING)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=GROUP ;
CLASS BRANCH FACTYPE IND CAT;
VAR AMOUNT COUNT ;
FORMAT IND $IMPIND. FACTYPE $FACDEC. BRANCH BRABBV.;
TABLE (FACTYPE='FACILITY TYPE' * (BRANCH='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2))  / RTS=30;
RUN;


======================================================   EIBMRP2B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET TEMP.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE FACGRP
       1 = '3OD'
       2 = '2FL'
       3 = '1HL'
       4 = '5RC'
       5 = '4BT'
   OTHER = '6OT'
       ;

   VALUE $FACDEC
      '3OD' = 'OD'
      '2FL' = 'FL'
      '1HL' = 'HL'
      '5RC' = 'RC'
      '4BT' = 'TRADE BILLS'
      '6OT' = 'OTHERS'
       ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
RUN;

PROC SORT DATA=TEMP.FINAL2 OUT=GROUP;BY BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM TEMP.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM TEMP.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM TEMP.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET TEMP.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 2';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'LOAN/FINANCING)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS BRABBV FACTYPE IND CAT;
VAR AMOUNT COUNT ;
FORMAT IND $IMPIND. FACTYPE $FACDEC.;
TABLE (FACTYPE='FACILITY TYPE' * (BRABBV='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=30;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP2C    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET TEMP.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE FACGRP
       1 = '3OD'
       2 = '2FL'
       3 = '1HL'
       4 = '5RC'
       5 = '4BT'
   OTHER = '6OT'
       ;

   VALUE $FACDEC
      '3OD' = 'OD'
      '2FL' = 'FL'
      '1HL' = 'HL'
      '5RC' = 'RC'
      '4BT' = 'TRADE BILLS'
      '6OT' = 'OTHERS'
       ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET TEMP.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA GROUP;
   SET TEMP.FINAL2;
   REG = PUT(BRANCH,REGCODE.);
RUN;

DATA BR;
   SET TEMP.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET TEMP.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 2';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'LOAN/FINANCING)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE REG = "&&SOURCE&I";
FORMAT BRANCH BRABBV.;
CLASS BRANCH FACTYPE IND CAT;
VAR AMOUNT COUNT ;
FORMAT IND $IMPIND. FACTYPE $FACDEC.;
TABLE (FACTYPE='FACILITY TYPE' * (BRANCH='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=30;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP2D    ======================================================  

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET TEMP.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE FACGRP
       1 = '3OD'
       2 = '2FL'
       3 = '1HL'
       4 = '5RC'
       5 = '4BT'
   OTHER = '6OT'
       ;

   VALUE $FACDEC
      '3OD' = 'OD'
      '2FL' = 'FL'
      '1HL' = 'HL'
      '5RC' = 'RC'
      '4BT' = 'TRADE BILLS'
      '6OT' = 'OTHERS'
       ;

   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
RUN;

PROC SORT DATA=TEMP.FINAL2 OUT=GROUP;BY BRANCH;RUN;
PROC SORT DATA=TEMP.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET TEMP.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 2';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY TYPE OF '
       'LOAN/FINANCING)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS BRABBV FACTYPE IND CAT;
VAR AMOUNT COUNT ;
FORMAT IND $IMPIND. FACTYPE $FACDEC.;
TABLE (FACTYPE='FACILITY TYPE' * (BRABBV='BRANCH' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=30;
RUN;

%END;
%MEND;
%TOUT;



======================================================   EIBMRP3A    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA NRRR(KEEP=AANO ACCTNO1 AANO1 BRANCH BRCHABR COUNT
               CUSTNAME CUSTID FACNAME TKDATE NOTENO NRRTAG)
    NRRS(KEEP=ACCTNO1 AANO1 BRANCH BRCHABR EXTFAC COUNT
              CUSTNAME CUSTID FACNAME TKDATE NOTENO NRRTAG);
   SET LIST.TFINAL;
   COUNT = 1;
   IF NRRTAG = 'NRRR' THEN DO;
      AANO1 = AANO;
      OUTPUT NRRR;
   END;
   IF NRRTAG = 'NRRS' THEN DO;
      AANO1 = AANO; OUTPUT NRRS;
   END;
RUN;

DATA NRRS1;
   SET NRRS;
   WORDCOUNT=COUNTW(EXTFAC,',');
   I=1;
   DO WHILE(I<=WORDCOUNT);
      AANO=COMPRESS(SCAN(EXTFAC,I,','), ' ');
      OUTPUT;
      I+1;
   END;
RUN;

DATA NRRS1;
   SET NRRS1;
   IF AANO NE ' ';
RUN;

DATA DAY1LIST;
   SET LIST.DAY1LIST;
   COUNT1 = 1;
   IF TKDATE = &REPTDATE THEN DELETE;
RUN;

PROC SUMMARY DATA=DAY1LIST NWAY;
CLASS AANO;
VAR COUNT1;
OUTPUT OUT=DAY1LIST1 SUM=;
RUN;

PROC SORT DATA=NRRS1 NODUPKEY;BY AANO;RUN;

DATA NRRS2(KEEP=AANO1 COUNT1 );
   MERGE NRRS1(IN=A) DAY1LIST1(IN=B);BY AANO;
   IF A AND B;
   IF COUNT1 = . THEN COUNT1 = 0;
RUN;

PROC SORT DATA=NRRR OUT=NRRRT NODUPKEY;BY AANO;RUN;
PROC SORT DATA=DAY1LIST OUT=DAY1LIST2(KEEP=AANO NRRTAG EXTFAC COUNT1
   RENAME=(NRRTAG=NRRTAG1)); BY AANO;
RUN;

DATA NRRR1;
   MERGE NRRRT(IN=A DROP=COUNT) DAY1LIST2(IN=B);BY AANO;
   IF A AND B;
RUN;


DATA NRRR2(DROP=AANO);
   SET NRRR1;
   IF NRRTAG1 = 'NRRS' THEN OUTPUT NRRR2;
RUN;


DATA NRRR2;
   SET NRRR2;
   WORDCOUNT=COUNTW(EXTFAC,',');
   I=1;
   DO WHILE(I<=WORDCOUNT);
      AANO=COMPRESS(SCAN(EXTFAC,I,','), ' ');
      OUTPUT;
      I+1;
   END;
RUN;

DATA NRRR2;
   SET NRRR2;
   IF AANO NE ' ';
RUN;

PROC SORT DATA=NRRR2 NODUPKEY;BY AANO;RUN;

DATA NRRR2(DROP=AANO RENAME=(AANO1=AANO));
   MERGE NRRR2(IN=A DROP=COUNT1) DAY1LIST1(IN=B);BY AANO;
   IF A AND B;
RUN;

DATA NRRR3;
   SET NRRR NRRR1 NRRR2;
   IF COUNT = . THEN COUNT = 0;
   IF COUNT1 = . THEN COUNT1 = 0;
   NEWCOUNT = SUM(COUNT,COUNT1);
RUN;

PROC SUMMARY DATA=NRRS2 NWAY;
CLASS AANO1;
VAR COUNT1;
OUTPUT OUT=NRRS2 SUM=;
RUN;

PROC SORT DATA=NRRS;BY AANO1;RUN;

DATA NRRS3(RENAME=(AANO1=AANO));
   MERGE NRRS(IN=A) NRRS2(IN=B);BY AANO1;
   IF COUNT = . THEN COUNT = 0;
   IF COUNT1 = . THEN COUNT1 = 0;
   NEWCOUNT = SUM(COUNT,COUNT1);
RUN;

DATA FINAL;
   SET NRRR3 NRRS3;
RUN;

%MACRO APPEND;
%IF &REPTDAY EQ 31 AND &REPTMON EQ 01 %THEN %DO;
   DATA LIST.FIN3FREQ&REPTYEAR;
      SET FINAL;
   RUN;
%END;
%ELSE %IF %SYSFUNC(EXIST(LIST.FIN3FREQ&REPTYEAR)) %THEN %DO;
   DATA LIST.FIN3FREQ&REPTYEAR;
      SET LIST.FIN3FREQ&REPTYEAR;
      IF TKDATE = &REPTDATE THEN DELETE;
   RUN;

   DATA LIST.FIN3FREQ&REPTYEAR;
      SET LIST.FIN3FREQ&REPTYEAR FINAL;
   RUN;
%END;
%ELSE %DO;
   DATA LIST.FIN3FREQ&REPTYEAR;
      SET FINAL;
   RUN;
%END;
%MEND;
%APPEND;

PROC SUMMARY DATA=FINAL NWAY;
CLASS CUSTNAME CUSTID AANO FACNAME;
VAR NEWCOUNT;
OUTPUT OUT=FINALA(DROP=_FREQ_ _TYPE_) SUM=;
RUN;

PROC SORT DATA=FINAL OUT=FINALB NODUPKEY;
   BY CUSTNAME CUSTID AANO FACNAME;
RUN;
PROC SORT DATA=FINALA;BY CUSTNAME CUSTID AANO FACNAME;RUN;

DATA FINAL;
   MERGE FINALB(IN=A) FINALA(IN=B);BY CUSTNAME CUSTID AANO FACNAME;
   IF A;
   IF NEWCOUNT = 1 THEN DO;  X1 = 1; END;
   IF NEWCOUNT = 2 THEN DO;  X2 = 1; END;
   IF NEWCOUNT = 3 THEN DO;  X3 = 1; END;
   IF NEWCOUNT = 4 THEN DO;  X4 = 1; END;
   IF NEWCOUNT = 5 THEN DO;  X5 = 1; END;
   IF NEWCOUNT > 5 THEN DO;  X6 = 1; END;
RUN;


DATA BRANCH(KEEP=BRANCH BRABBV) ;
  SET LIST.BR1;
RUN;

PROC SORT DATA=FINAL;BY BRANCH;RUN;
PROC SORT DATA=BRANCH;BY BRANCH;RUN;

DATA LIST.FINAL3;
   MERGE BRANCH(IN=A) FINAL(IN=B);BY BRANCH;
   IF X1=. THEN X1=0;
   IF X2=. THEN X2=0;
   IF X3=. THEN X3=0;
   IF X4=. THEN X4=0;
   IF X5=. THEN X5=0;
   IF X6=. THEN X6=0;
   GROUP='F';
   IF A;
RUN;

PROC FORMAT;
   VALUE $GNAME
   'F'  =  'FREQUENCY OF MODIFICATION CONDUCTED';

RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

PROC SUMMARY DATA=LIST.FINAL3 NWAY;
CLASS BRANCH CUSTNAME CUSTID AANO FACNAME GROUP;
VAR X1 X2 X3 X4 X5 X6;
OUTPUT OUT=FINAL SUM=;
RUN;

TITLE1 'REPORT 3';
TITLE2 'LISTING OF BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR '
       'EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=FINAL MISSING;
FORMAT GROUP $GNAME. BRANCH BRABBV.;
CLASS BRANCH CUSTNAME CUSTID AANO FACNAME GROUP;
VAR X1 X2 X3 X4 X5 X6;
TABLE BRANCH='BRANCH' * CUSTNAME='NAME OF CUSTOMER'
* CUSTID='CUSTOMER ID' * AANO='A/A NO' * FACNAME='FACILITY' ,
GROUP=' '*(X1='1X'*SUM=' '*F=5. X2='2X'*SUM=' '*F=5.
X3='3X'*SUM=' '*F=5. X4='4X'*SUM=' '*F=5. X5='5X'*SUM=' '*F=5.
X6='>5X'*SUM=' '*F=5. ) / RTS=100;
RUN;


======================================================   EIBMRP3B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE $GNAME
   'F'  =  'FREQUENCY OF MODIFICATION CONDUCTED';

RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;
PROC SORT DATA=LIST.FINAL3 OUT=FINAL;BY BRANCH;RUN;

PROC TABULATE DATA=FINAL MISSING;
TITLE1 'REPORT 3';
TITLE2 'LISTING OF BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR '
       'EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
FORMAT GROUP $GNAME. ;
CLASS BRABBV CUSTNAME CUSTID AANO FACNAME GROUP;
VAR X1 X2 X3 X4 X5 X6;
TABLE BRABBV='BRANCH' * CUSTNAME='NAME OF CUSTOMER'
* CUSTID='CUSTOMER ID' * AANO='A/A NO' * FACNAME='FACILITY' ,
GROUP=' '*(X1='1X'*SUM=' '*F=5. X2='2X'*SUM=' '*F=5.
X3='3X'*SUM=' '*F=5. X4='4X'*SUM=' '*F=5. X5='5X'*SUM=' '*F=5.
X6='>5X'*SUM=' '*F=5. ) / RTS=100;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP3C    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE $GNAME
   'F'  =  'FREQUENCY OF MODIFICATION CONDUCTED';

RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

DATA FINAL;
   SET LIST.FINAL3;
   REG = PUT(BRANCH,REGCODE.);
RUN;

PROC SORT DATA=FINAL;BY BRANCH;RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=FINAL MISSING;
TITLE1 'REPORT 3';
TITLE2 'LISTING OF BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR '
       'EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE REG = "&&SOURCE&I";
FORMAT GROUP $GNAME. BRANCH BRABBV.;
CLASS BRANCH CUSTNAME CUSTID AANO FACNAME GROUP;
VAR X1 X2 X3 X4 X5 X6;
TABLE BRANCH='BRANCH' * CUSTNAME='NAME OF CUSTOMER'
* CUSTID='CUSTOMER ID' * AANO='A/A NO' * FACNAME='FACILITY' ,
GROUP=' '*(X1='1X'*SUM=' '*F=5. X2='2X'*SUM=' '*F=5.
X3='3X'*SUM=' '*F=5. X4='4X'*SUM=' '*F=5. X5='5X'*SUM=' '*F=5.
X6='>5X'*SUM=' '*F=5. ) / RTS=100;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP3D    ======================================================  

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC FORMAT;
   VALUE $GNAME
   'F'  =  'FREQUENCY OF MODIFICATION CONDUCTED';

RUN;

PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;
PROC SORT DATA=LIST.FINAL3 OUT=FINAL;BY BRANCH;RUN;

PROC TABULATE DATA=FINAL MISSING;
TITLE1 'REPORT 3';
TITLE2 'LISTING OF BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR '
       'EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
FORMAT GROUP $GNAME. ;
CLASS BRABBV CUSTNAME CUSTID AANO FACNAME GROUP;
VAR X1 X2 X3 X4 X5 X6;
TABLE BRABBV='BRANCH' * CUSTNAME='NAME OF CUSTOMER'
* CUSTID='CUSTOMER ID' * AANO='A/A NO' * FACNAME='FACILITY' ,
GROUP=' '*(X1='1X'*SUM=' '*F=5. X2='2X'*SUM=' '*F=5.
X3='3X'*SUM=' '*F=5. X4='4X'*SUM=' '*F=5. X5='5X'*SUM=' '*F=5.
X6='>5X'*SUM=' '*F=5. ) / RTS=100;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP4A    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE FREQDEC
      1 = '1 TIME'
      2 = '2 TIMES'
      3 = '3 TIMES'
      4 = '4 TIMES'
      5 = '5 TIMES'
  OTHER = '>5 TIMES'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA BRANCH;
   SET LIST.BR1;
   FORMAT CAT $20. FREQ 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      FREQ = 1;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 2;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 3;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 4;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 5;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 6;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 6;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 1;CAT = 'YEAR TO DATE'; OUTPUT;
      FREQ = 2;CAT = 'YEAR TO DATE'; OUTPUT;
      FREQ = 3;CAT = 'YEAR TO DATE'; OUTPUT;
      FREQ = 4;CAT = 'YEAR TO DATE'; OUTPUT;
      FREQ = 5;CAT = 'YEAR TO DATE'; OUTPUT;
      FREQ = 6;CAT = 'YEAR TO DATE'; OUTPUT;
   END;
RUN;

DATA BRANCH1;
   SET LIST.BR1;
   FORMAT CAT $20. FREQ 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      FREQ = 1;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 2;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 3;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 4;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 5;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 6;CAT = 'CURRENT MONTH'; OUTPUT;
      FREQ = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      FREQ = 6;CAT = 'PREVIOUS MONTH'; OUTPUT;
   END;
RUN;

PROC SUMMARY DATA=LIST.FIN3FREQ&REPTYEAR NWAY MISSING;
CLASS ACCTNO1 NOTENO AANO TKDATE;
VAR NEWCOUNT;
OUTPUT OUT=FIN3FREQ(DROP=_FREQ_ _TYPE_ RENAME=(NEWCOUNT=COUNT)) SUM=;
RUN;

PROC SORT DATA=LIST.TFINAL&REPTYEAR OUT=TFINAL NODUPKEY;
BY ACCTNO1 NOTENO AANO TKDATE;RUN;

DATA TF3FREQ;
   MERGE TFINAL(IN=A) FIN3FREQ(IN=B);BY ACCTNO1 NOTENO AANO TKDATE;
   IF A;
RUN;

DATA A1 A2 A3 IM1 IM2;
   SET TF3FREQ;
   FORMAT CAT $20.;
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
 /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN;*/

PROC SORT DATA=A3 OUT=ALN31;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN;*/

DATA GROUP(DROP=IMPAIRED RENAME=(COUNT=FREQ));
   SET A1 A2 A3;
RUN;

DATA GROUP1(RENAME=(COUNT=FREQ));
   SET IM1 IM2;
RUN;

PROC SORT DATA=GROUP;BY BRANCH FREQ CAT ;RUN;
PROC SORT DATA=BRANCH;BY BRANCH FREQ CAT ;RUN;

DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH FREQ CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SORT DATA=GROUP1;BY BRANCH FREQ CAT ;RUN;
PROC SORT DATA=BRANCH1;BY BRANCH FREQ CAT ;RUN;

DATA GROUP1(KEEP=BRANCH BRABBV FREQ AMOUNT CAT COUNT);
   MERGE BRANCH1(IN=A) GROUP1(IN=B);BY BRANCH FREQ CAT ;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1 ;
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;
PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;
DATA FOFMT2;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

DATA LIST.FINAL4 GROUP;
   SET GROUP(IN=A) GROUP1(IN=B);
   IF A THEN IND = 'N';
   IF B THEN IND = 'Y';
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
   REGCODE = PUT(BRANCH,REGCODE.);
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

TITLE1 'REPORT 4';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=GROUP ;
CLASS REGCODE BRANCH FREQ IND CAT;
VAR AMOUNT COUNT ;
FORMAT FREQ FREQDEC. IND $IMPIND. BRANCH BRABBV. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRANCH='BRANCH' *
FREQ='NO OF TIMES' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=9.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=50;
RUN;


======================================================   EIBMRP4B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE FREQDEC
      1 = '1 TIME'
      2 = '2 TIMES'
      3 = '3 TIMES'
      4 = '4 TIMES'
      5 = '5 TIMES'
  OTHER = '>5 TIMES'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;

DATA FOFMT1;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL4 ;
TITLE1 'REPORT 4';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS REGCODE BRABBV FREQ IND CAT;
VAR AMOUNT COUNT ;
FORMAT FREQ FREQDEC. IND $IMPIND. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRABBV='BRANCH' *
FREQ='NO OF TIMES' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=9.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=50;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP4C    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE FREQDEC
      1 = '1 TIME'
      2 = '2 TIMES'
      3 = '3 TIMES'
      4 = '4 TIMES'
      5 = '5 TIMES'
  OTHER = '>5 TIMES'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA GROUP;
   SET LIST.FINAL4;
   REG=PUT(BRANCH,REGCODE.);
RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

DATA FOFMT3;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT3;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 4';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE REG = "&&SOURCE&I";
CLASS REGCODE BRANCH FREQ IND CAT;
VAR AMOUNT COUNT ;
FORMAT FREQ FREQDEC. IND $IMPIND. BRANCH BRABBV. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRANCH='BRANCH' *
FREQ='NO OF TIMES' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=9.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=50;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP4D    ======================================================  


OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE FREQDEC
      1 = '1 TIME'
      2 = '2 TIMES'
      3 = '3 TIMES'
      4 = '4 TIMES'
      5 = '5 TIMES'
  OTHER = '>5 TIMES'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;


PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;

DATA FOFMT1;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL4 ;
TITLE1 'REPORT 4';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY FREQUENCY)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS REGCODE BRABBV FREQ IND CAT;
VAR AMOUNT COUNT ;
FORMAT FREQ FREQDEC. IND $IMPIND. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRABBV='BRANCH' *
FREQ='NO OF TIMES' ALL='SUB TOTAL')
ALL='TOTAL'),
IND=' '*(CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=9.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)) / RTS=50;
RUN;

%END;
%MEND;
%TOUT;



======================================================   EIBMRP5A    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE MIADEC
      0 = '0'
      1 = '1'
      2 = '2'
      3 = '3 & ABOVE (IL)'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA BRANCH;
   SET LIST.BR1;
   FORMAT CAT $20. MIA 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      MIA = 0;CAT = 'CURRENT MONTH'; OUTPUT;
      MIA = 1;CAT = 'CURRENT MONTH'; OUTPUT;
      MIA = 2;CAT = 'CURRENT MONTH'; OUTPUT;
      MIA = 3;CAT = 'CURRENT MONTH'; OUTPUT;
      MIA = 0;CAT = 'PREVIOUS MONTH'; OUTPUT;
      MIA = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      MIA = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      MIA = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      MIA = 0;CAT = 'YEAR TO DATE'; OUTPUT;
      MIA = 1;CAT = 'YEAR TO DATE'; OUTPUT;
      MIA = 2;CAT = 'YEAR TO DATE'; OUTPUT;
      MIA = 3;CAT = 'YEAR TO DATE'; OUTPUT;
   END;
RUN;

DATA A1 A2 A3 IM1 IM2;
   SET LIST.TFINAL&REPTYEAR;
   FORMAT CAT $20.;
   IF MTHARR = . THEN MTHARR = 0;
   IF MTHARR = 0 THEN MIA = 0;
   ELSE IF MTHARR = 1 THEN MIA = 1;
   ELSE IF MTHARR = 2 THEN MIA = 2;
   ELSE MIA = 3;
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
 /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN; */

PROC SORT DATA=A3 OUT=ALN31;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN;*/

DATA GROUP(DROP=IMPAIRED );
   SET A1 A2 A3;
RUN;

PROC SORT DATA=GROUP;BY BRANCH MIA CAT ;RUN;
PROC SORT DATA=BRANCH;BY BRANCH MIA CAT ;RUN;

DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH MIA CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SUMMARY DATA=A3 NWAY;
VAR AMOUNT;
OUTPUT OUT=A3SUM SUM=;
RUN;

DATA _NULL_;
   SET A3SUM;
   CALL SYMPUT('TOTAMT',AMOUNT);
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;


PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;
DATA FOFMT2;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

DATA LIST.FINAL5 GROUP;
   SET GROUP;
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
   REGCODE = PUT(BRANCH,REGCODE.);
   IF CAT = 'YEAR TO DATE' THEN DO;
      COMPOSITION = (AMOUNT / &TOTAMT) * 100;
   END;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

TITLE1 'REPORT 5';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY MONTHS IN ARREARS)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=GROUP ;
CLASS REGCODE BRANCH MIA CAT;
VAR AMOUNT COUNT COMPOSITION;
FORMAT MIA MIADEC. BRANCH BRABBV. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRANCH='BRANCH' *
MIA='MONTHS IN ARREARS' ALL='SUB TOTAL')
ALL='TOTAL'),
CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 )
COMPOSITION=' '*SUM='COMPOSITION(%)' * F=17.2 ;
RUN;



======================================================   EIBMRP5B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE MIADEC
      0 = '0'
      1 = '1'
      2 = '2'
      3 = '3 & ABOVE (IL)'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;


PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;
DATA FOFMT1;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA FINAL(DROP=COMPOSITION);
   SET LIST.FINAL5;
   WHERE BRABBV = "&&SOURCE&I";
RUN;

PROC SUMMARY DATA=FINAL NWAY;
WHERE CAT = 'YEAR TO DATE';
VAR AMOUNT;
OUTPUT OUT=A3SUM SUM=;
RUN;

DATA _NULL_;
   SET A3SUM;
   CALL SYMPUT('TOTAMT',AMOUNT);
RUN;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

DATA FINAL;
   SET FINAL;
   IF CAT = 'YEAR TO DATE' THEN DO;
      COMPOSITION = (AMOUNT / &TOTAMT) * 100;
      IF COMPOSITION = . THEN COMPOSITION = 0;
   END;
RUN;

PROC TABULATE DATA=FINAL;
TITLE1 'REPORT 5';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY MONTHS IN ARREARS)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
CLASS REGCODE BRABBV MIA CAT;
VAR AMOUNT COUNT COMPOSITION;
FORMAT MIA MIADEC. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRABBV='BRANCH' *
MIA='MONTH IN ARREARS' ALL='SUB TOTAL')
ALL='TOTAL'),
CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)
COMPOSITION=' '*SUM='COMPOSITION(%)' * F=17.2 ;
RUN;

 %END;
 %MEND;
 %TOUT;

======================================================   EIBMRP5C    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE MIADEC
      0 = '0'
      1 = '1'
      2 = '2'
      3 = '3 & ABOVE (IL)'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA FINAL;
   SET LIST.FINAL5;
   REG=PUT(BRANCH,REGCODE.);
RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

DATA FOFMT3;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT3;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA GROUP;
   SET FINAL;
   WHERE REG = "&&SOURCE&I";
RUN;

PROC SUMMARY DATA=GROUP NWAY;
WHERE CAT = 'YEAR TO DATE';
VAR AMOUNT;
OUTPUT OUT=A3SUM SUM=;
RUN;

DATA _NULL_;
   SET A3SUM;
   CALL SYMPUT('TOTAMT',AMOUNT);
RUN;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

DATA GROUP;
   SET GROUP;
   IF CAT = 'YEAR TO DATE' THEN DO;
      COMPOSITION = (AMOUNT / &TOTAMT) * 100;
      IF COMPOSITION = . THEN COMPOSITION = 0;
   END;
RUN;

PROC TABULATE DATA=GROUP;
TITLE1 'REPORT 5';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY MONTHS IN ARREARS)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
CLASS REGCODE BRABBV MIA CAT;
VAR AMOUNT COUNT COMPOSITION;
FORMAT MIA MIADEC. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRABBV='BRANCH' *
MIA='MONTHS IN ARREARS' ALL='SUB TOTAL')
ALL='TOTAL'),
CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)
COMPOSITION=' '*SUM='COMPOSITION(%)' * F=17.2 ;
RUN;

 %END;
 %MEND;
 %TOUT;


======================================================   EIBMRP5D    ======================================================  

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE MIADEC
      0 = '0'
      1 = '1'
      2 = '2'
      3 = '3 & ABOVE (IL)'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;
DATA FOFMT1;
  LENGTH START $3. LABEL $35. FMTNAME $7. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG2;
  FMTNAME = 'REGDECS';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA FINAL(DROP=COMPOSITION);
   SET LIST.FINAL5;
   WHERE BRABBV = "&&SOURCE&I";
RUN;

PROC SUMMARY DATA=FINAL NWAY;
WHERE CAT = 'YEAR TO DATE';
VAR AMOUNT;
OUTPUT OUT=A3SUM SUM=;
RUN;

DATA _NULL_;
   SET A3SUM;
   CALL SYMPUT('TOTAMT',AMOUNT);
RUN;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

DATA FINAL;
   SET FINAL;
   IF CAT = 'YEAR TO DATE' THEN DO;
      COMPOSITION = (AMOUNT / &TOTAMT) * 100;
      IF COMPOSITION = . THEN COMPOSITION = 0;
   END;
RUN;

PROC TABULATE DATA=FINAL;
TITLE1 'REPORT 5';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY MONTHS IN ARREARS)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
CLASS REGCODE BRABBV MIA CAT;
VAR AMOUNT COUNT COMPOSITION;
FORMAT MIA MIADEC. REGCODE $REGDECS.;
TABLE (REGCODE='REGION' * (BRABBV='BRANCH' *
MIA='MONTHS IN ARREARS' ALL='SUB TOTAL')
ALL='TOTAL'),
CAT=' '*(COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2)
COMPOSITION=' '*SUM='COMPOSITION(%)' * F=17.2 ;
RUN;

 %END;
 %MEND;
 %TOUT;


======================================================   EIBMRP6A    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'D'
      8 = 'E'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA BRANCH;
   SET LIST.BR1;
   FORMAT CAT $20. CRRGRD 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      CRRGRD = 1; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 2; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 3; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 4; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 5; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 6; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 7; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 8; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 6;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 7;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 8;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 1;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 2;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 3;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 4;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 5;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 6;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 7;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 8;CAT = 'YEAR TO DATE'; OUTPUT;
   END;
RUN;

DATA BRANCH1;
   SET LIST.BR1;
   FORMAT CAT $20. CRRGRD 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      CRRGRD = 1;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 2;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 3;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 4;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 5;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 6;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 7;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 8;CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 6;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 7;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 8;CAT = 'PREVIOUS MONTH'; OUTPUT;
   END;
RUN;

DATA A1 A2 A3 IM1 IM2;
   SET LIST.TFINAL&REPTYEAR;
   FORMAT CAT $20. CRRGRD 1.;
   IF COMSCORE NE ' ' THEN DELETE;
   IF LENGTH(CRR) = 5 THEN DO;
      IF SUBSTR(CRR,1,2) = 'AA' THEN CRRGRD = 1;
      IF SUBSTR(CRR,1,2) = 'BB' THEN CRRGRD = 3;
      IF SUBSTR(CRR,1,2) = 'CC' THEN CRRGRD = 5;
   END;
   ELSE DO;
      IF SUBSTR(CRR,1,1) = 'A' THEN CRRGRD = 2;
      IF SUBSTR(CRR,1,1) = 'B' THEN CRRGRD = 4;
      IF SUBSTR(CRR,1,1) = 'C' THEN CRRGRD = 6;
      IF SUBSTR(CRR,1,1) = 'D' THEN CRRGRD = 7;
      IF SUBSTR(CRR,1,1) = 'E' THEN CRRGRD = 8;
   END;
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
 /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN;*/

PROC SORT DATA=A3 OUT=ALN31 NODUPKEY;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31 NODUPKEY;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN;*/

DATA GROUP(DROP=IMPAIRED );
   SET A1 A2 A3;
RUN;

DATA GROUP1;
   SET IM1 IM2;
RUN;

PROC SORT DATA=GROUP;BY BRANCH CRRGRD CAT ;RUN;
PROC SORT DATA=BRANCH;BY BRANCH CRRGRD CAT ;RUN;

DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH CRRGRD CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SORT DATA=GROUP1;BY BRANCH CRRGRD CAT ;RUN;
PROC SORT DATA=BRANCH1;BY BRANCH CRRGRD CAT ;RUN;

DATA GROUP1;
   MERGE BRANCH1(IN=A) GROUP1(IN=B);BY BRANCH CRRGRD CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

DATA LIST.FINAL6 GROUP;
   SET GROUP(IN=A) GROUP1(IN=B);
   IF A THEN IND = 'N';
   IF B THEN IND = 'Y';
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

TITLE1 'REPORT 6';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY CRR GRADE)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=GROUP ;
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='CRR GRADE' RTS=20;
RUN;

======================================================   EIBMRP6B    ======================================================
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'D'
      8 = 'E'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL6 ;
TITLE1 'REPORT 6';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY CRR GRADE)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='CRR GRADE' RTS=20;
RUN;

 %END;
 %MEND;
 %TOUT;


======================================================   EIBMRP6C    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'D'
      8 = 'E'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA GROUP;
   SET LIST.FINAL6;
   REG = PUT(BRANCH,REGCODE.);
RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 6';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY CRR GRADE)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE REG = "&&SOURCE&I";
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='CRR GRADE' RTS=20;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP6D    ======================================================  

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'D'
      8 = 'E'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL6 ;
TITLE1 'REPORT 6';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
       'INSTALMENT AND/OR EXTENDED TENURE(BY CRR GRADE)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='CRR GRADE' RTS=20;
RUN;

 %END;
 %MEND;
 %TOUT;


======================================================   EIBMRP7A    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=242 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA FINAL;
   SET LIST.TFINAL;
   RETAIN NO 0;
   NO=NO+1;
   IF ILAMT=. THEN ILAMT=0;
   IF MTHARR=. THEN MTHARR=0;
RUN;

PROC CONTENTS DATA=FINAL NOPRINT
   OUT=CHECK(KEEP=NOBS);
RUN;

DATA _NULL_;
   SET CHECK(OBS=1);
   CALL SYMPUT("NOREC",NOBS);
RUN;

%MACRO CHECK;
   %IF &NOREC = 0 %THEN %DO;
DATA FINAL; /*
   FORMAT MAANO AANO $13. REQNO $14. CUSTNAME FACNAME APPRNAME $15.
   NRRTAG $4. CRR $5. ; */
   NO=.; MAANO=' '; AANO=' '; REQNO=' '; CUSTNAME=' '; FACNAME=' ';
   APPRAMT=.; AMOUNT=.; DSR=.; CRR=' '; MA=.; APPRNAME=' ';
   APPRDATE1=' '; ACCPTDATE1=' '; NRRTAG=' '; ILAMT=.; MTHARR=.;
RUN;
   %END;
%MEND;
%CHECK;

PROC REPORT DATA=FINAL NOWD HEADLINE SPLIT='*' SPACING=2 ;
TITLE1 'LISTING REPORT';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR EXTENDED '
       'TENURE(LISTING REPORT)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
COLUMN NO MAANO AANO REQNO CUSTNAME FACNAME APPRAMT AMOUNT DSR CRR
MRISKGRD SCORECARD CCRISCOMM COMSCORE
MA APPRNAME APPRDATE1 ACCPTDATE1 NRRTAG ILAMT MTHARR;
DEFINE NO / DISPLAY 'NO.' WIDTH=3 ;
DEFINE MAANO / DISPLAY 'PRIMARY*A/A NO' WIDTH=13;
DEFINE AANO / DISPLAY 'A/A NO' WIDTH=13;
DEFINE REQNO / DISPLAY 'EREQUEST NO' WIDTH=14 FLOW;
DEFINE CUSTNAME / DISPLAY 'NAME OF BORROWER' WIDTH=15 FLOW;
DEFINE FACNAME / DISPLAY 'FACILITY' WIDTH=10 FLOW;
DEFINE APPRAMT / 'AMOUNT APPROVED' FORMAT=COMMA14.2 FLOW;
DEFINE AMOUNT / 'OUTSTANDING *AMOUNT' FORMAT=COMMA14.2 FLOW;
DEFINE DSR / WIDTH=5 FLOW;
DEFINE CRR / WIDTH=5 FLOW;
DEFINE MRISKGRD / 'MASTER*RISK *GRADE- *SCORE*CARD*RISK *GRADE'
       WIDTH=7 FLOW;
DEFINE SCORECARD / 'SCORE*CARD *RISK *GRADE' WIDTH=5 FLOW;
DEFINE CCRISCOMM / 'WITH/*WITH*-OUT*CCRIS*COMMI*TMENT' WIDTH=5 FLOW;
DEFINE COMSCORE / 'COMMERCIAL*A-SCORE*GRADE' WIDTH=13 FLOW;
DEFINE MA / 'M/A' WIDTH=6 FLOW;
DEFINE APPRNAME / DISPLAY 'APPROVED*BY' WIDTH=8 FLOW;
DEFINE APPRDATE1 / DISPLAY 'APPROVED DATE' WIDTH=10;
DEFINE ACCPTDATE1 / DISPLAY 'ACCEPTED DATE' WIDTH=10;
DEFINE NRRTAG / DISPLAY 'NRRR/*NRRS' WIDTH=5;
DEFINE ILAMT / DISPLAY 'IL(RM)' FORMAT=COMMA14.2 FLOW;
DEFINE MTHARR / DISPLAY 'MIA' WIDTH=3;
RUN;

======================================================   EIBMRP7B    ======================================================
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=242 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

DATA FINAL;
   SET LIST.TFINAL;
   IF BRANCH = "&&VAR&I";
   RETAIN NO 0;
   NO=NO+1;
   IF ILAMT=. THEN ILAMT=0;
   IF MTHARR=. THEN MTHARR=0;
RUN;

PROC CONTENTS DATA=FINAL NOPRINT
   OUT=CHECK(KEEP=NOBS);
RUN;

DATA _NULL_;
   SET CHECK(OBS=1);
   CALL SYMPUT("NOREC",NOBS);
RUN;

%MACRO CHECK;
   %IF &NOREC = 0 %THEN %DO;
DATA FINAL; /*
   FORMAT MAANO AANO $13. REQNO $14. CUSTNAME FACNAME APPRNAME $15.
   NRRTAG $4. CRR $5. ; */
   NO=.; MAANO=' '; AANO=' '; REQNO=' '; CUSTNAME=' '; FACNAME=' ';
   APPRAMT=.; AMOUNT=.; DSR=.; CRR=' '; MA=.; APPRNAME=' ';
   APPRDATE1=' '; ACCPTDATE1=' '; NRRTAG=' '; ILAMT=.; MTHARR=.;
RUN;
   %END;
%MEND;
%CHECK;

PROC REPORT DATA=FINAL NOWD HEADLINE SPLIT='*' SPACING=2 ;
TITLE1 ' ';
TITLE2 'LISTING REPORT';
TITLE3 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR EXTENDED '
       'TENURE(LISTING REPORT)';
TITLE4 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE5 'REGION : ' "&REGION";
TITLE6 'REPORTING PERIOD : ' "&RDATE";
TITLE7 'REPORTING ENTITY : PBB ';
COLUMN NO MAANO AANO REQNO CUSTNAME FACNAME APPRAMT AMOUNT DSR CRR
MRISKGRD SCORECARD CCRISCOMM COMSCORE
MA APPRNAME APPRDATE1 ACCPTDATE1 NRRTAG ILAMT MTHARR;
DEFINE NO / DISPLAY 'NO.' WIDTH=3 ;
DEFINE MAANO / DISPLAY 'PRIMARY*A/A NO' WIDTH=13;
DEFINE AANO / DISPLAY 'A/A NO' WIDTH=13;
DEFINE REQNO / DISPLAY 'EREQUEST NO' WIDTH=14 FLOW;
DEFINE CUSTNAME / DISPLAY 'NAME OF BORROWER' WIDTH=15 FLOW;
DEFINE FACNAME / DISPLAY 'FACILITY' WIDTH=10 FLOW;
DEFINE APPRAMT / 'AMOUNT APPROVED' FORMAT=COMMA14.2 FLOW;
DEFINE AMOUNT / 'OUTSTANDING *AMOUNT' FORMAT=COMMA14.2 FLOW;
DEFINE DSR / WIDTH=5 FLOW;
DEFINE CRR / WIDTH=5 FLOW;
DEFINE MRISKGRD / 'MASTER*RISK *GRADE- *SCORE*CARD*RISK *GRADE'
       WIDTH=7 FLOW;
DEFINE SCORECARD / 'SCORE*CARD *RISK *GRADE' WIDTH=5 FLOW;
DEFINE CCRISCOMM / 'WITH/*WITH*-OUT*CCRIS*COMMI*TMENT' WIDTH=5 FLOW;
DEFINE COMSCORE / 'COMMERCIAL*A-SCORE*GRADE' WIDTH=13 FLOW;
DEFINE MA / 'M/A' WIDTH=6 FLOW;
DEFINE APPRNAME / DISPLAY 'APPROVED*BY' WIDTH=8 FLOW;
DEFINE APPRDATE1 / DISPLAY 'APPROVED DATE' WIDTH=10;
DEFINE ACCPTDATE1 / DISPLAY 'ACCEPTED DATE' WIDTH=10;
DEFINE NRRTAG / DISPLAY 'NRRR/*NRRS' WIDTH=5;
DEFINE ILAMT / DISPLAY 'IL(RM)' FORMAT=COMMA14.2 FLOW;
DEFINE MTHARR / DISPLAY 'MIA' WIDTH=3;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP7C    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=242 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR NODUPKEY;BY REG;RUN;
PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

DATA FINAL;
   SET LIST.TFINAL;
   REG=PUT(BRANCH,REGCODE.);
   IF REG = "&&SOURCE&I";
   RETAIN NO 0;
   NO=NO+1;
   IF ILAMT=. THEN ILAMT=0;
   IF MTHARR=. THEN MTHARR=0;
RUN;

PROC CONTENTS DATA=FINAL NOPRINT
   OUT=CHECK(KEEP=NOBS);
RUN;

DATA _NULL_;
   SET CHECK(OBS=1);
   CALL SYMPUT("NOREC",NOBS);
RUN;

%MACRO CHECK;
   %IF &NOREC = 0 %THEN %DO;
DATA FINAL; /*
   FORMAT MAANO AANO $13. REQNO $14. CUSTNAME FACNAME APPRNAME $15.
   NRRTAG $4. CRR $5. ; */
   NO=.; MAANO=' '; AANO=' '; REQNO=' '; CUSTNAME=' '; FACNAME=' ';
   APPRAMT=.; AMOUNT=.; DSR=.; CRR=' '; MA=.; APPRNAME=' ';
   APPRDATE1=' '; ACCPTDATE1=' '; NRRTAG=' '; ILAMT=.; MTHARR=.;
RUN;
   %END;
%MEND;
%CHECK;

PROC REPORT DATA=FINAL NOWD HEADLINE SPLIT='*' SPACING=2 ;
TITLE1 ' ';
TITLE2 'LISTING REPORT';
TITLE3 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR EXTENDED '
       'TENURE(LISTING REPORT)';
TITLE4 'BRANCH : BRANCHES';
TITLE5 'REGION : ' "&REGION";
TITLE6 'REPORTING PERIOD : ' "&RDATE";
TITLE7 'REPORTING ENTITY : PBB ';
COLUMN NO MAANO AANO REQNO CUSTNAME FACNAME APPRAMT AMOUNT DSR CRR
MRISKGRD SCORECARD CCRISCOMM COMSCORE
MA APPRNAME APPRDATE1 ACCPTDATE1 NRRTAG ILAMT MTHARR;
DEFINE NO / DISPLAY 'NO.' WIDTH=3 ;
DEFINE MAANO / DISPLAY 'PRIMARY*A/A NO' WIDTH=13;
DEFINE AANO / DISPLAY 'A/A NO' WIDTH=13;
DEFINE REQNO / DISPLAY 'EREQUEST NO' WIDTH=14 FLOW;
DEFINE CUSTNAME / DISPLAY 'NAME OF BORROWER' WIDTH=15 FLOW;
DEFINE FACNAME / DISPLAY 'FACILITY' WIDTH=10 FLOW;
DEFINE APPRAMT / 'AMOUNT APPROVED' FORMAT=COMMA14.2 FLOW;
DEFINE AMOUNT / 'OUTSTANDING *AMOUNT' FORMAT=COMMA14.2 FLOW;
DEFINE DSR / WIDTH=5 FLOW;
DEFINE CRR / WIDTH=5 FLOW;
DEFINE MRISKGRD / 'MASTER*RISK *GRADE- *SCORE*CARD*RISK *GRADE'
       WIDTH=7 FLOW;
DEFINE SCORECARD / 'SCORE*CARD *RISK *GRADE' WIDTH=5 FLOW;
DEFINE CCRISCOMM / 'WITH/*WITH*-OUT*CCRIS*COMMI*TMENT' WIDTH=5 FLOW;
DEFINE COMSCORE / 'COMMERCIAL*A-SCORE*GRADE' WIDTH=13 FLOW;
DEFINE MA / 'M/A' WIDTH=6 FLOW;
DEFINE APPRNAME / DISPLAY 'APPROVED*BY' WIDTH=8 FLOW;
DEFINE APPRDATE1 / DISPLAY 'APPROVED DATE' WIDTH=10;
DEFINE ACCPTDATE1 / DISPLAY 'ACCEPTED DATE' WIDTH=10;
DEFINE NRRTAG / DISPLAY 'NRRR/*NRRS' WIDTH=5;
DEFINE ILAMT / DISPLAY 'IL(RM)' FORMAT=COMMA14.2 FLOW;
DEFINE MTHARR / DISPLAY 'MIA' WIDTH=3;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP7D    ======================================================  

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=242 NODATE NONUMBER
PAGESIZE=57;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

DATA FINAL;
   SET LIST.TFINAL;
   IF BRANCH = "&&VAR&I";
   RETAIN NO 0;
   NO=NO+1;
   IF ILAMT=. THEN ILAMT=0;
   IF MTHARR=. THEN MTHARR=0;
RUN;

PROC CONTENTS DATA=FINAL NOPRINT
   OUT=CHECK(KEEP=NOBS);
RUN;

DATA _NULL_;
   SET CHECK(OBS=1);
   CALL SYMPUT("NOREC",NOBS);
RUN;

%MACRO CHECK;
   %IF &NOREC = 0 %THEN %DO;
DATA FINAL; /*
   FORMAT MAANO AANO $13. REQNO $14. CUSTNAME FACNAME APPRNAME $15.
   NRRTAG $4. CRR $5. ; */
   NO=.; MAANO=' '; AANO=' '; REQNO=' '; CUSTNAME=' '; FACNAME=' ';
   APPRAMT=.; AMOUNT=.; DSR=.; CRR=' '; MA=.; APPRNAME=' ';
   APPRDATE1=' '; ACCPTDATE1=' '; NRRTAG=' '; ILAMT=.; MTHARR=.;
RUN;
   %END;
%MEND;
%CHECK;

PROC REPORT DATA=FINAL NOWD HEADLINE SPLIT='*' SPACING=2 ;
TITLE1 ' ';
TITLE2 'LISTING REPORT';
TITLE3 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS WITH ZERO DAYS ARREARS '
       'WITH REDUCED INSTALMENT AND/OR EXTENDED '
       'TENURE(LISTING REPORT)';
TITLE4 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE5 'REGION : ' "&REGION";
TITLE6 'REPORTING PERIOD : ' "&RDATE";
TITLE7 'REPORTING ENTITY : PBB';
COLUMN NO MAANO AANO REQNO CUSTNAME FACNAME APPRAMT AMOUNT DSR CRR
MRISKGRD SCORECARD CCRISCOMM COMSCORE
MA APPRNAME APPRDATE1 ACCPTDATE1 NRRTAG ILAMT MTHARR;
DEFINE NO / DISPLAY 'NO.' WIDTH=3 ;
DEFINE MAANO / DISPLAY 'PRIMARY*A/A NO' WIDTH=13;
DEFINE AANO / DISPLAY 'A/A NO' WIDTH=13;
DEFINE REQNO / DISPLAY 'EREQUEST NO' WIDTH=14 FLOW;
DEFINE CUSTNAME / DISPLAY 'NAME OF BORROWER' WIDTH=15 FLOW;
DEFINE FACNAME / DISPLAY 'FACILITY' WIDTH=10 FLOW;
DEFINE APPRAMT / 'AMOUNT APPROVED' FORMAT=COMMA14.2 FLOW;
DEFINE AMOUNT / 'OUTSTANDING *AMOUNT' FORMAT=COMMA14.2 FLOW;
DEFINE DSR / WIDTH=5 FLOW;
DEFINE CRR / WIDTH=5 FLOW;
DEFINE MRISKGRD / 'MASTER*RISK *GRADE- *SCORE*CARD*RISK *GRADE'
       WIDTH=7 FLOW;
DEFINE SCORECARD / 'SCORE*CARD *RISK *GRADE' WIDTH=5 FLOW;
DEFINE CCRISCOMM / 'WITH/*WITH*-OUT*CCRIS*COMMI*TMENT' WIDTH=5 FLOW;
DEFINE COMSCORE / 'COMMERCIAL*A-SCORE*GRADE' WIDTH=13 FLOW;
DEFINE MA / 'M/A' WIDTH=6 FLOW;
DEFINE APPRNAME / DISPLAY 'APPROVED*BY' WIDTH=8 FLOW;
DEFINE APPRDATE1 / DISPLAY 'APPROVED DATE' WIDTH=10;
DEFINE ACCPTDATE1 / DISPLAY 'ACCEPTED DATE' WIDTH=10;
DEFINE NRRTAG / DISPLAY 'NRRR/*NRRS' WIDTH=5;
DEFINE ILAMT / DISPLAY 'IL(RM)' FORMAT=COMMA14.2 FLOW;
DEFINE MTHARR / DISPLAY 'MIA' WIDTH=3;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP8A    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=230 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE SCRISK
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'DD'
      8 = 'D'
      9 = 'E'
     10 = 'F'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA BRANCH;
   SET LIST.BR1;
   FORMAT CAT $20. SCRISKGRD 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      SCRISKGRD = 1; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 2; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 3; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 4; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 5; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 6; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 7; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 8; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 9; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 10; CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 6;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 7;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 8;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 9;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 10;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 1;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 2;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 3;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 4;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 5;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 6;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 7;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 8;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 9;CAT = 'YEAR TO DATE'; OUTPUT;
      SCRISKGRD = 10;CAT = 'YEAR TO DATE'; OUTPUT;
   END;
RUN;

DATA BRANCH1;
   SET LIST.BR1;
   FORMAT CAT $20. SCRISKGRD 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      SCRISKGRD = 1;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 2;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 3;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 4;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 5;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 6;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 7;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 8;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 9;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 10;CAT = 'CURRENT MONTH'; OUTPUT;
      SCRISKGRD = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 6;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 7;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 8;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 9;CAT = 'PREVIOUS MONTH'; OUTPUT;
      SCRISKGRD = 10;CAT = 'PREVIOUS MONTH'; OUTPUT;
   END;
RUN;

DATA A1 A2 A3 IM1 IM2;
   SET LIST.TFINAL&REPTYEAR;
   FORMAT CAT $20. SCRISKGRD 1.;
   IF COMSCORE NE ' ' THEN DELETE;
   IF SCORECARD = 'AA' THEN SCRISKGRD = 1;
   IF SCORECARD = 'A'  THEN SCRISKGRD = 2;
   IF SCORECARD = 'BB' THEN SCRISKGRD = 3;
   IF SCORECARD = 'B'  THEN SCRISKGRD = 4;
   IF SCORECARD = 'CC' THEN SCRISKGRD = 5;
   IF SCORECARD = 'C'  THEN SCRISKGRD = 6;
   IF SCORECARD = 'DD' THEN SCRISKGRD = 7;
   IF SCORECARD = 'D'  THEN SCRISKGRD = 8;
   IF SCORECARD = 'E'  THEN SCRISKGRD = 9;
   IF SCORECARD = 'F'  THEN SCRISKGRD = 10;
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
 /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN;*/

PROC SORT DATA=A3 OUT=ALN31 NODUPKEY;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31 NODUPKEY;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN;*/

DATA GROUP(DROP=IMPAIRED );
   SET A1 A2 A3;
RUN;

DATA GROUP1;
   SET IM1 IM2;
RUN;

PROC SORT DATA=GROUP;BY BRANCH SCRISKGRD CAT ;RUN;
PROC SORT DATA=BRANCH;BY BRANCH SCRISKGRD CAT ;RUN;

DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH SCRISKGRD CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SORT DATA=GROUP1;BY BRANCH SCRISKGRD CAT ;RUN;
PROC SORT DATA=BRANCH1;BY BRANCH SCRISKGRD CAT ;RUN;

DATA GROUP1;
   MERGE BRANCH1(IN=A) GROUP1(IN=B);BY BRANCH SCRISKGRD CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

DATA LIST.FINAL8 GROUP;
   SET GROUP(IN=A) GROUP1(IN=B);
   IF A THEN IND = 'N';
   IF B THEN IND = 'Y';
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

TITLE1 'REPORT 7';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WHERE THERE ARE MODIFICATIONS '
       'OF THEIR ORIGINAL REPAYMENT TERMS AND CONDITIONALS WITH '
       'REDUCED INSTALMENT AND/OR EXTENDED(BY A-SCORE GRADE)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB';
PROC TABULATE DATA=GROUP ;
CLASS IND SCRISKGRD CAT;
FORMAT IND $IMPIND. SCRISKGRD SCRISK.;
VAR AMOUNT COUNT ;
TABLE (SCRISKGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='A-SCORE(SCORECARD RISK GRADE)' RTS=20;
RUN;

======================================================   EIBMRP8B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=230 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE SCRISK
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'DD'
      8 = 'D'
      9 = 'E'
     10 = 'F'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL8 ;
TITLE1 'REPORT 7';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WHERE THERE ARE MODIFICATIONS '
       'OF THEIR ORIGINAL REPAYMENT TERMS AND CONDITIONALS WITH '
       'REDUCED INSTALMENT AND/OR EXTENDED(BY A-SCORE GRADE)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS IND SCRISKGRD CAT;
FORMAT IND $IMPIND. SCRISKGRD SCRISK.;
VAR AMOUNT COUNT ;
TABLE (SCRISKGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='A-SCORE(SCORECARD RISK GRADE)' RTS=20;
RUN;

 %END;
 %MEND;
 %TOUT;

======================================================   EIBMRP8C    ====================================================== 
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=230 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE SCRISK
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'DD'
      8 = 'D'
      9 = 'E'
     10 = 'F'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA GROUP;
   SET LIST.FINAL8;
   REG = PUT(BRANCH,REGCODE.);
RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 7';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WHERE THERE ARE MODIFICATIONS '
       'OF THEIR ORIGINAL REPAYMENT TERMS AND CONDITIONALS WITH '
       'REDUCED INSTALMENT AND/OR EXTENDED(BY A-SCORE GRADE)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE REG = "&&SOURCE&I";
CLASS IND SCRISKGRD CAT;
FORMAT IND $IMPIND. SCRISKGRD SCRISK.;
VAR AMOUNT COUNT ;
TABLE (SCRISKGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='A-SCORE(SCORECARD RISK GRADE)' RTS=20;
RUN;

%END;
%MEND;
%TOUT;


======================================================   EIBMRP8D    ======================================================  
OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=230 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE SCRISK
      1 = 'AA'
      2 = 'A'
      3 = 'BB'
      4 = 'B'
      5 = 'CC'
      6 = 'C'
      7 = 'DD'
      8 = 'D'
      9 = 'E'
     10 = 'F'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL8 ;
TITLE1 'REPORT 7';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WHERE THERE ARE MODIFICATIONS '
       'OF THEIR ORIGINAL REPAYMENT TERMS AND CONDITIONALS WITH '
       'REDUCED INSTALMENT AND/OR EXTENDED(BY A-SCORE GRADE)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS IND SCRISKGRD CAT;
FORMAT IND $IMPIND. SCRISKGRD SCRISK.;
VAR AMOUNT COUNT ;
TABLE (SCRISKGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='A-SCORE(SCORECARD RISK GRADE)' RTS=20;
RUN;

 %END;
 %MEND;
 %TOUT;





======================================================   EIBMRP9A    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;
   VALUE CRRGRADE
      1 = 'FICO MICRO/SMALL'
      2 = 'FICO MEDIUM'
      3 = 'S&P'
      4 = 'EXTERNAL RATING'
      5 = 'INTERNAL RATING'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA BRANCH;
   SET LIST.BR1;
   FORMAT CAT $20. CRRGRD 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      CRRGRD = 1; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 2; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 3; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 4; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 5; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 1;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 2;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 3;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 4;CAT = 'YEAR TO DATE'; OUTPUT;
      CRRGRD = 5;CAT = 'YEAR TO DATE'; OUTPUT;
   END;
RUN;

DATA BRANCH1;
   SET LIST.BR1;
   FORMAT CAT $20. CRRGRD 1.;
   BY BRANCH;
   IF FIRST.BRANCH THEN DO;
      CRRGRD = 1; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 2; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 3; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 4; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 5; CAT = 'CURRENT MONTH'; OUTPUT;
      CRRGRD = 1;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 2;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 3;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 4;CAT = 'PREVIOUS MONTH'; OUTPUT;
      CRRGRD = 5;CAT = 'PREVIOUS MONTH'; OUTPUT;
   END;
RUN;

DATA A1 A2 A3 IM1 IM2;
   SET LIST.TFINAL&REPTYEAR;
   FORMAT CAT $20. CRRGRD 1.;
   IF COMSCORE NE ' ';
   IF COMSCORETYP='FICO MICRO/SMALL' THEN CRRGRD = 1;
   IF COMSCORETYP='FICO MEDIUM'      THEN CRRGRD = 2;
   IF COMSCORETYP='S&P'              THEN CRRGRD = 3;
   IF COMSCORETYP='EXTERNAL RATING'  THEN CRRGRD = 4;
   IF COMSCORETYP='INTERNAL RATING'  THEN CRRGRD = 5;
   DATE = MDY(MONTH(&REPTDATE),1,YEAR(&REPTDATE));
   DATE1 = DATE - 1;
   IF MONTH(ACCPTDATE) <= MONTH(DATE) THEN DO;
      CAT = 'YEAR TO DATE'; OUTPUT A3;
   END;
   IF MONTH(ACCPTDATE) = MONTH(DATE) THEN DO;
      CAT = 'CURRENT MONTH'; OUTPUT A1;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'CURRENT MONTH'; OUTPUT IM1;
      END;
   END;
   ELSE IF MONTH(ACCPTDATE) = MONTH(DATE1) THEN DO;
      CAT = 'PREVIOUS MONTH'; OUTPUT A2;
      IF IMPAIRED = 'Y' THEN DO;
         CAT = 'PREVIOUS MONTH';
         OUTPUT IM2;
      END;
   END;
RUN;
 /*
DATA A3_BT A3_LN;
   SET A3;
   IF TYPE = 'LN' THEN OUTPUT A3_LN;
   ELSE OUTPUT A3_BT;
RUN;*/

PROC SORT DATA=A3 OUT=ALN31 NODUPKEY;
BY ACCTNO1 NOTENO;RUN;
PROC SORT DATA=LIST.LN OUT=GETBAL(KEEP=ACCTNO1 NOTENO BALANCE)
 NODUPKEY;BY ACCTNO1 NOTENO;RUN;

DATA A3;
   MERGE ALN31(IN=A) GETBAL(IN=B);BY ACCTNO1 NOTENO;
   IF A;
   IF BALANCE NE . AND FACGRP NE '4' THEN AMOUNT = BALANCE;
RUN;
 /*
PROC SORT DATA=A3_BT(DROP=AMOUNT) OUT=ABT31 NODUPKEY;
BY ACCTNO1 AANO;RUN;
PROC SORT DATA=LIST.BT OUT=GETBAL(KEEP=ACCTNO1 AANO APPRLIMT
 RENAME=(APPRLIMT=AMOUNT)) NODUPKEY;BY ACCTNO1 AANO;RUN;

DATA A3_BT;
   MERGE ABT31(IN=A) GETBAL(IN=B);BY ACCTNO1 AANO;
   IF A;
RUN;

DATA A3;
   SET A3_LN A3_BT;
RUN;*/

DATA GROUP(DROP=IMPAIRED );
   SET A1 A2 A3;
RUN;

DATA GROUP1;
   SET IM1 IM2;
RUN;

PROC SORT DATA=GROUP;BY BRANCH CRRGRD CAT ;RUN;
PROC SORT DATA=BRANCH;BY BRANCH CRRGRD CAT ;RUN;

DATA GROUP;
   MERGE BRANCH(IN=A) GROUP(IN=B);BY BRANCH CRRGRD CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

PROC SORT DATA=GROUP1;BY BRANCH CRRGRD CAT ;RUN;
PROC SORT DATA=BRANCH1;BY BRANCH CRRGRD CAT ;RUN;

DATA GROUP1;
   MERGE BRANCH1(IN=A) GROUP1(IN=B);BY BRANCH CRRGRD CAT;
   IF A;
   IF ACCPTDATE NE . THEN COUNT = 1;
RUN;

DATA LIST.FINAL9 GROUP;
   SET GROUP(IN=A) GROUP1(IN=B);
   IF A THEN IND = 'N';
   IF B THEN IND = 'Y';
   IF AMOUNT = . THEN AMOUNT = 0;
   IF COUNT = . THEN COUNT = 0;
RUN;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

TITLE1 'REPORT 9';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
      'BORROWERS/CUSTOMERS '
      'WITH ZERO DAYS ARREARS WITH REDUCED '
      'INSTALMENT AND/OR EXTENDED TENURE(BY COMMERCIAL A-SCORE GRADE)';
TITLE3 'BRANCH : COD';
TITLE4 'REGION : ALL REGION';
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
PROC TABULATE DATA=GROUP ;
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='COMMERCIAL A-SCORE GRADE' RTS=20;
RUN;

======================================================   EIBMRP9B    ======================================================

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'FICO MICRO/SMALL'
      2 = 'FICO MEDIUM'
      3 = 'S&P'
      4 = 'EXTERNAL RATING'
      5 = 'INTERNAL RATING'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM LIST.BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM LIST.BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM LIST.BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL9 ;
TITLE1 'REPORT 9';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
      'INSTALMENT AND/OR EXTENDED TENURE(BY COMMERCIAL A-SCORE GRADE)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='COMMERCIAL A-SCORE GRADE' RTS=20;
RUN;

 %END;
 %MEND;
 %TOUT;

======================================================   EIBMRP9C    ====================================================== 

OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'FICO MICRO/SMALL'
      2 = 'FICO MEDIUM'
      3 = 'S&P'
      4 = 'EXTERNAL RATING'
      5 = 'INTERNAL RATING'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

DATA FOFMT1;
  LENGTH START 3. LABEL $3. FMTNAME $7. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG;
  FMTNAME = 'REGCODE';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT1;
RUN;

DATA GROUP;
   SET LIST.FINAL9;
   REG = PUT(BRANCH,REGCODE.);
RUN;

DATA BR;
   SET LIST.BR1;
RUN;
PROC SORT DATA=BR NODUPKEY;BY REG;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT REG INTO :SOURCE1 - :SOURCE&CNT
   FROM BR;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $3. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = BRABBV;
  FMTNAME = 'BRABBV';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

DATA FOFMT2;
  LENGTH START $3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET BR;
  START = REG;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'C';
RUN;
PROC FORMAT CNTLIN=FOFMT2;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT("&&SOURCE&I",$REGDEC.);
   CALL SYMPUT('REGION', PUT(REG1,$60.));
RUN;

PROC TABULATE DATA=GROUP ;
TITLE1 'REPORT 9';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
      'INSTALMENT AND/OR EXTENDED TENURE(BY COMMERCIAL A-SCORE GRADE)';
TITLE3 'BRANCH : BRANCHES';
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE REG = "&&SOURCE&I";
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='COMMERCIAL A-SCORE GRADE' RTS=20;
RUN;

%END;
%MEND;
%TOUT;

======================================================   EIBMRP9D    ======================================================  


OPTIONS YEARCUTOFF=1950 NOCENTER LINESIZE=220 NODATE NONUMBER
PAGESIZE=57;

PROC FORMAT;
   VALUE $IMPIND
      'N' = '   '
      'Y' = 'IMPAIRED LOAN @'
      ;

   VALUE CRRGRADE
      1 = 'FICO MICRO/SMALL'
      2 = 'FICO MEDIUM'
      3 = 'S&P'
      4 = 'EXTERNAL RATING'
      5 = 'INTERNAL RATING'
      ;
RUN;

DATA REPTDATE;
    SET LIST.REPTDATE;
    IF MONTH(REPTDATE)+1 = 13 THEN DO;
       MM = 1;
       YY = YEAR(REPTDATE)+1;
    END;
    ELSE DO;
       MM = MONTH(REPTDATE)+1;
       YY = YEAR(REPTDATE);
    END;
    SDATE = MDY(MM,1,YY)-1;
    CALL SYMPUT('REPTDAY',PUT(DAY(REPTDATE),Z2.));
    CALL SYMPUT('REPTMON',PUT(MONTH(REPTDATE),Z2.));
    CALL SYMPUT('REPTYEAR',PUT(REPTDATE,YEAR2.));
    CALL SYMPUT('REPTDATE',PUT(REPTDATE,Z5.));
    CALL SYMPUT('SDATE',PUT(SDATE,Z5.));
    CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
RUN;

PROC SORT DATA=LIST.BR1 OUT=BR1;BY REG BRANCH;RUN;

PROC SQL NOPRINT;
   SELECT COUNT(*) INTO : CNT FROM BR1;
QUIT;
%LET CNT=&CNT;

PROC SQL NOPRINT;
   SELECT BRABBV INTO :SOURCE1 - :SOURCE&CNT
   FROM BR1;
QUIT;

PROC SQL NOPRINT;
   SELECT BRANCH INTO :VAR1 - :VAR&CNT
   FROM BR1;
QUIT;

DATA FOFMT;
  LENGTH START 3. LABEL $39. FMTNAME $6. TYPE $1.;
  SET LIST.BR1;
  START = BRANCH;
  LABEL = REG1;
  FMTNAME = 'REGDEC';
  TYPE = 'N';
RUN;
PROC FORMAT CNTLIN=FOFMT;
RUN;

%MACRO TOUT;
 %DO I=1 %TO &CNT;

DATA _NULL_;
   REG1 = PUT(&&VAR&I,REGDEC.);
   CALL SYMPUT('REGION',REG1);
RUN;

PROC TABULATE DATA=LIST.FINAL9 ;
TITLE1 'REPORT 9';
TITLE2 'PERFORMANCE REPORT OF NON-FINANCIALLY DISTRESS '
       'BORROWERS/CUSTOMERS '
       'WITH ZERO DAYS ARREARS WITH REDUCED '
      'INSTALMENT AND/OR EXTENDED TENURE(BY COMMERCIAL A-SCORE GRADE)';
TITLE3 'BRANCH : ' "&&VAR&I" '/' "&&SOURCE&I";
TITLE4 'REGION : ' "&REGION";
TITLE5 'REPORTING PERIOD : ' "&RDATE";
TITLE6 'REPORTING ENTITY : PBB ';
WHERE BRABBV = "&&SOURCE&I";
CLASS IND CRRGRD CAT;
FORMAT IND $IMPIND. CRRGRD CRRGRADE.;
VAR AMOUNT COUNT ;
TABLE (CRRGRD =' ' ALL='TOTAL'),
IND=' '* (CAT=' '* (COUNT='NO OF A/C'*SUM=' '*F=10.
AMOUNT='AMOUNT'*SUM=' '*F=COMMA17.2 ))
 / BOX='COMMERCIAL A-SCORE GRADE' RTS=20;
RUN;

 %END;
 %MEND;
 %TOUT;
